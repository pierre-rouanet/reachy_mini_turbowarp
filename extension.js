(function(){"use strict";const O=new Set(["localhost","127.0.0.1","::1","[::1]"]),E=o=>{try{const e=new URL(o);if(!O.has(e.hostname))throw new Error(`[ReachyMiniApiClient] Base URL must point to localhost (received ${e.hostname})`);const t=e.pathname.replace(/\/+$/,"");return e.pathname=t.length>0?t:"",e.toString().replace(/\/+$/,"")}catch(e){throw e instanceof Error?new Error(`[ReachyMiniApiClient] Invalid base URL: ${e.message}`):new Error("[ReachyMiniApiClient] Invalid base URL")}},j=o=>{const e=o.trim().replace(/^\/+|\/+$/g,"");if(e.length===0)throw new Error("[ReachyMiniApiClient] Dataset name is required");return e.split("/").map(t=>encodeURIComponent(t)).join("/")},S={baseUrl:"http://localhost:8000/api",timeout:3e4};class b extends Error{constructor(e,t,n){super(e),this.statusCode=t,this.originalError=n,this.name="ApiError"}}async function h(o,e,t){const n=new AbortController,a=setTimeout(()=>n.abort(),t);try{const i=await fetch(o,{...e,signal:n.signal});if(clearTimeout(a),!i.ok)throw new b(`HTTP error! status: ${i.status}`,i.status);return await i.json()}catch(i){throw clearTimeout(a),i instanceof b?i:i instanceof Error?i.name==="AbortError"?new b("Request timeout",void 0,i):new b(`Network error: ${i.message}`,void 0,i):new b("Unknown error occurred")}}class N{constructor(e={}){const t=E(e.baseUrl??S.baseUrl);this.config={baseUrl:t,timeout:e.timeout??S.timeout}}updateConfig(e){const t=e.baseUrl?E(e.baseUrl):this.config.baseUrl;this.config={...this.config,...e,baseUrl:t}}getBaseUrl(){return this.config.baseUrl}async wakeUp(){const e=`${this.config.baseUrl}/move/play/wake_up`;return h(e,{method:"POST",headers:{"Content-Type":"application/json"}},this.config.timeout)}async gotoSleep(){const e=`${this.config.baseUrl}/move/play/goto_sleep`;return h(e,{method:"POST",headers:{"Content-Type":"application/json"}},this.config.timeout)}async goto(e){const t=`${this.config.baseUrl}/move/goto`,n={...e};return typeof n.body_yaw=="number"&&(n.body_yaw=-n.body_yaw),h(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)},this.config.timeout)}async isMovementRunning(){const e=`${this.config.baseUrl}/move/running`;return(await h(e,{method:"GET",headers:{"Content-Type":"application/json"}},this.config.timeout)).length>0}async stopMovement(){const e=`${this.config.baseUrl}/move/stop`;return h(e,{method:"POST",headers:{"Content-Type":"application/json"}},this.config.timeout)}async listRecordedMoves(e){const t=j(e),n=`${this.config.baseUrl}/move/recorded-move-datasets/list/${t}`;return h(n,{method:"GET",headers:{"Content-Type":"application/json"}},this.config.timeout)}async playRecordedMove(e,t){const n=j(e),a=encodeURIComponent(t),i=`${this.config.baseUrl}/move/play/recorded-move-dataset/${n}/${a}`;return h(i,{method:"POST",headers:{"Content-Type":"application/json"}},this.config.timeout)}async getFullState(){const e=`${this.config.baseUrl}/state/full`;return h(e,{method:"GET",headers:{"Content-Type":"application/json"}},this.config.timeout)}async getHeadPose(){const e=`${this.config.baseUrl}/state/present_head_pose`;return h(e,{method:"GET",headers:{"Content-Type":"application/json"}},this.config.timeout)}async getBodyYaw(){const e=`${this.config.baseUrl}/state/present_body_yaw`;return h(e,{method:"GET",headers:{"Content-Type":"application/json"}},this.config.timeout)}async getAntennaPositions(){const e=`${this.config.baseUrl}/state/present_antenna_joint_positions`;return h(e,{method:"GET",headers:{"Content-Type":"application/json"}},this.config.timeout)}async getMotorStatus(){const e=`${this.config.baseUrl}/motors/status`;return h(e,{method:"GET",headers:{"Content-Type":"application/json"}},this.config.timeout)}async setMotorMode(e){const t=`${this.config.baseUrl}/motors/set_mode/${e}`;return h(t,{method:"POST",headers:{"Content-Type":"application/json"}},this.config.timeout)}async getDaemonStatus(){const e=`${this.config.baseUrl}/daemon/status`;return h(e,{method:"GET",headers:{"Content-Type":"application/json"}},this.config.timeout)}async ping(){try{return await this.getDaemonStatus(),!0}catch{return!1}}}const m=new N;function s(o){return o*Math.PI/180}function p(o){return o*180/Math.PI}function d(o){return new Promise(e=>setTimeout(e,o))}const v={"reachymini.extension.name":"Reachy Mini","reachymini.blocks.wakeUp":"wake up robot","reachymini.blocks.gotoSleep":"put robot to sleep","reachymini.blocks.moveHeadDirection":"move head [DIRECTION] for [DURATION] seconds","reachymini.blocks.moveHeadCustom":"move head pitch [PITCH]° yaw [YAW]° roll [ROLL]° for [DURATION]s","reachymini.blocks.playRecordedMove":"play recorded move [MOVE]","reachymini.menus.recordedMove.empty":"no moves available","reachymini.blocks.performPresetMotion":"run preset motion [MOTION] [CYCLES] times","reachymini.blocks.moveAntennas":"move antennas left [LEFT]° right [RIGHT]° for [DURATION]s","reachymini.blocks.moveAntennasBoth":"move both antennas [ANGLE]° for [DURATION]s","reachymini.blocks.moveBodyYaw":"move body yaw [ANGLE]° for [DURATION]s","reachymini.blocks.setMotorMode":"set motor mode [MODE]","reachymini.blocks.getHeadPitch":"head pitch (degrees)","reachymini.blocks.getHeadYaw":"head yaw (degrees)","reachymini.blocks.getHeadRoll":"head roll (degrees)","reachymini.blocks.getLeftAntenna":"left antenna angle (degrees)","reachymini.blocks.getRightAntenna":"right antenna angle (degrees)","reachymini.blocks.getBodyYaw":"body yaw (degrees)","reachymini.blocks.getMotorMode":"motor mode","reachymini.blocks.isDaemonConnected":"daemon connected?","reachymini.menus.headDirection.center":"center","reachymini.menus.headDirection.up":"up","reachymini.menus.headDirection.down":"down","reachymini.menus.headDirection.left":"left","reachymini.menus.headDirection.right":"right","reachymini.menus.headDirection.upLeft":"up left","reachymini.menus.headDirection.upRight":"up right","reachymini.menus.headDirection.downLeft":"down left","reachymini.menus.headDirection.downRight":"down right","reachymini.menus.motionPreset.headNod":"head nod","reachymini.menus.motionPreset.headShake":"head shake","reachymini.menus.motionPreset.antennaWave":"antenna wave","reachymini.menus.motionPreset.bodySway":"body sway","reachymini.menus.recordedDataset.dances":"dances library","reachymini.menus.recordedDataset.emotions":"emotions library","reachymini.menus.motorMode.enabled":"enabled","reachymini.menus.motorMode.disabled":"disabled","reachymini.menus.motorMode.gravityComp":"gravity compensation"},T={en:v,ja:{"reachymini.extension.name":"Reachy Mini","reachymini.blocks.wakeUp":"ロボットを起こす","reachymini.blocks.gotoSleep":"ロボットを寝かせる","reachymini.blocks.moveHeadDirection":"頭を [DIRECTION] に [DURATION] 秒動かす","reachymini.blocks.moveHeadCustom":"頭を pitch [PITCH]° yaw [YAW]° roll [ROLL]° で [DURATION] 秒動かす","reachymini.blocks.playRecordedMove":"録画モーション [MOVE] を再生する","reachymini.menus.recordedMove.empty":"モーションが見つかりません","reachymini.blocks.performPresetMotion":"プリセット動作 [MOTION] を [CYCLES] 回再生する","reachymini.blocks.moveAntennas":"アンテナを 左 [LEFT]° 右 [RIGHT]° で [DURATION] 秒動かす","reachymini.blocks.moveAntennasBoth":"両方のアンテナを [ANGLE]° で [DURATION] 秒動かす","reachymini.blocks.moveBodyYaw":"胴体を [ANGLE]° で [DURATION] 秒動かす","reachymini.blocks.setMotorMode":"モーターを [MODE] モードにする","reachymini.blocks.getHeadPitch":"頭のピッチ角 (度)","reachymini.blocks.getHeadYaw":"頭のヨー角 (度)","reachymini.blocks.getHeadRoll":"頭のロール角 (度)","reachymini.blocks.getLeftAntenna":"左アンテナ角度 (度)","reachymini.blocks.getRightAntenna":"右アンテナ角度 (度)","reachymini.blocks.getBodyYaw":"胴体のヨー角 (度)","reachymini.blocks.getMotorMode":"モード","reachymini.blocks.isDaemonConnected":"デーモン接続中？","reachymini.menus.headDirection.center":"まんなか","reachymini.menus.headDirection.up":"うえ","reachymini.menus.headDirection.down":"した","reachymini.menus.headDirection.left":"ひだり","reachymini.menus.headDirection.right":"みぎ","reachymini.menus.headDirection.upLeft":"うえ ひだり","reachymini.menus.headDirection.upRight":"うえ みぎ","reachymini.menus.headDirection.downLeft":"した ひだり","reachymini.menus.headDirection.downRight":"した みぎ","reachymini.menus.motionPreset.headNod":"うなずく","reachymini.menus.motionPreset.headShake":"首をふる","reachymini.menus.motionPreset.antennaWave":"アンテナをふる","reachymini.menus.motionPreset.bodySway":"からだをゆらす","reachymini.menus.recordedDataset.dances":"ダンスライブラリ","reachymini.menus.recordedDataset.emotions":"感情ライブラリ","reachymini.menus.motorMode.enabled":"オン","reachymini.menus.motorMode.disabled":"オフ","reachymini.menus.motorMode.gravityComp":"重力補償"}},k=()=>globalThis.Scratch,U=()=>{const o=k();if(!o||typeof o.translate!="function")return;const e=o.translate,t=e.language??"unknown",n=o.vm?.runtime?.getLocale?.();console.warn("[ReachyMiniExtension] Translation setup",{scratchTranslateLanguage:t,runtimeLocale:n??"unavailable"}),typeof e.setup=="function"&&e.setup(T)},A=()=>{const o=k(),e=o?.vm?.runtime?.getLocale?.();if(e&&e in T)return e;const t=o?.translate?.language;return t&&t in T?t:"en"},r=o=>{const e=A();return(T[e]??v)[o]??v[o]},I={UP:{pitch:-.3,yaw:0,roll:0},DOWN:{pitch:.3,yaw:0,roll:0},LEFT:{pitch:0,yaw:.5,roll:0},RIGHT:{pitch:0,yaw:-.5,roll:0},UP_LEFT:{pitch:-.3,yaw:.5,roll:0},UP_RIGHT:{pitch:-.3,yaw:-.5,roll:0},DOWN_LEFT:{pitch:.3,yaw:.5,roll:0},DOWN_RIGHT:{pitch:.3,yaw:-.5,roll:0},CENTER:{pitch:0,yaw:0,roll:0}},g={x:0,y:0,z:0,roll:0,pitch:0,yaw:0},L={HEAD_NOD:{interpolation:"ease",steps:[{head:{pitch:s(-12)},duration:.35},{head:{pitch:s(12)},duration:.35},{head:{pitch:0},duration:.3}]},HEAD_SHAKE:{interpolation:"ease",steps:[{head:{yaw:s(15)},duration:.35},{head:{yaw:s(-15)},duration:.35},{head:{yaw:0},duration:.3}]},ANTENNA_WAVE:{interpolation:"minjerk",steps:[{antennas:[s(18),s(-18)],duration:.4},{antennas:[s(-18),s(18)],duration:.4},{antennas:[0,0],duration:.3}]},BODY_SWAY:{interpolation:"cartoon",steps:[{head:{yaw:s(5)},bodyYaw:s(8),duration:.45},{head:{yaw:s(-5)},bodyYaw:s(-8),duration:.45},{head:{yaw:0},bodyYaw:0,duration:.3}]}},x=o=>({x:o?.x??g.x,y:o?.y??g.y,z:o?.z??g.z,roll:o?.roll??g.roll,pitch:o?.pitch??g.pitch,yaw:o?.yaw??g.yaw}),w="pollen-robotics/reachy-mini-dances-library",_="pollen-robotics/reachy-mini-emotions-library",f=["groovy_sway_and_roll","headbanger_combo","uh_huh_tilt","side_to_side_sway","dizzy_spin","neck_recoil","jackson_square","side_peekaboo","sharp_side_tilt","chin_lead","stumble_and_recover","head_tilt_roll","yeah_nod","interwoven_spirals","chicken_peck","simple_nod","polyrhythm_combo","grid_snap","side_glance_flick","pendulum_swing"],P=["dance3","displeased1","welcoming1","surprised1","reprimand3","dance1","disgusted1","curious1","contempt1","sad2","thoughtful2","enthusiastic2","understanding1","amazed1","impatient2","success2","grateful1","scared1","inquiring2","success1","indifferent1","displeased2","thoughtful1","reprimand2","fear1","no1","cheerful1","shy1","downcast1","boredom1","laughing1","irritated1","lost1","frustrated1","exhausted1","irritated2","dance2","dying1","confused1","inquiring1","proud3","relief1","enthusiastic1","attentive1","calming1","reprimand1","attentive2","uncertain1","oops1","boredom2","surprised2","uncomfortable1","sleep1","furious1","resigned1","helpful1","proud1","come1","go_away1","lonely1","yes_sad1","inquiring3","incomprehensible2","electric1","welcoming2","rage1","oops2","anxiety1","understanding2","laughing2","no_excited1","helpful2","relief2","yes1","proud2","sad1","loving1","impatient1","tired1","serenity1","no_sad1"],H={[w]:"reachymini.menus.recordedDataset.dances",[_]:"reachymini.menus.recordedDataset.emotions"},R="||",C={1:{en:"1",ja:"1"},2:{en:"2",ja:"2"},3:{en:"3",ja:"3"},amazed:{en:"Amazed",ja:"驚き"},and:{en:"and",ja:"＆"},anxiety:{en:"Anxiety",ja:"不安"},attentive:{en:"Attentive",ja:"注目"},away:{en:"Away",ja:"離れて"},boredom:{en:"Boredom",ja:"退屈"},calming:{en:"Calming",ja:"落ち着き"},cheerful:{en:"Cheerful",ja:"陽気"},chicken:{en:"Chicken",ja:"チキン"},chin:{en:"Chin",ja:"あご"},combo:{en:"Combo",ja:"コンボ"},come:{en:"Come",ja:"おいで"},confused:{en:"Confused",ja:"混乱"},contempt:{en:"Contempt",ja:"軽蔑"},curious:{en:"Curious",ja:"好奇心"},dance:{en:"Dance",ja:"ダンス"},disgusted:{en:"Disgusted",ja:"嫌悪"},displeased:{en:"Displeased",ja:"不満"},dizzy:{en:"Dizzy",ja:"めまい"},downcast:{en:"Downcast",ja:"うつむき"},dying:{en:"Dying",ja:"弱り"},electric:{en:"Electric",ja:"エレクトリック"},enthusiastic:{en:"Enthusiastic",ja:"熱意"},excited:{en:"Excited",ja:"興奮"},exhausted:{en:"Exhausted",ja:"疲労"},fear:{en:"Fear",ja:"恐れ"},flick:{en:"Flick",ja:"フリック"},frustrated:{en:"Frustrated",ja:"いら立ち"},furious:{en:"Furious",ja:"激怒"},glance:{en:"Glance",ja:"ちらり"},go:{en:"Go",ja:"行って"},grateful:{en:"Grateful",ja:"感謝"},grid:{en:"Grid",ja:"グリッド"},groovy:{en:"Groovy",ja:"グルーヴィー"},head:{en:"Head",ja:"ヘッド"},headbanger:{en:"Headbanger",ja:"ヘッドバンガー"},helpful:{en:"Helpful",ja:"助けたい"},huh:{en:"Huh",ja:"ハッ"},impatient:{en:"Impatient",ja:"いらだち"},incomprehensible:{en:"Incomprehensible",ja:"理解不能"},indifferent:{en:"Indifferent",ja:"無関心"},inquiring:{en:"Inquiring",ja:"問いかけ"},interwoven:{en:"Interwoven",ja:"絡み合う"},irritated:{en:"Irritated",ja:"イライラ"},jackson:{en:"Jackson",ja:"ジャクソン"},laughing:{en:"Laughing",ja:"笑い"},lead:{en:"Lead",ja:"リード"},lonely:{en:"Lonely",ja:"孤独"},lost:{en:"Lost",ja:"迷い"},loving:{en:"Loving",ja:"愛情"},neck:{en:"Neck",ja:"ネック"},no:{en:"No",ja:"いいえ"},nod:{en:"Nod",ja:"うなずき"},oops:{en:"Oops",ja:"おっと"},peck:{en:"Peck",ja:"つつき"},peekaboo:{en:"Peekaboo",ja:"いないいないばあ"},pendulum:{en:"Pendulum",ja:"振り子"},polyrhythm:{en:"Polyrhythm",ja:"ポリリズム"},proud:{en:"Proud",ja:"誇り"},rage:{en:"Rage",ja:"激昂"},recoil:{en:"Recoil",ja:"のけぞり"},recover:{en:"Recover",ja:"立て直し"},relief:{en:"Relief",ja:"安心"},reprimand:{en:"Reprimand",ja:"叱責"},resigned:{en:"Resigned",ja:"諦め"},roll:{en:"Roll",ja:"ロール"},sad:{en:"Sad",ja:"悲しみ"},scared:{en:"Scared",ja:"怖い"},serenity:{en:"Serenity",ja:"穏やか"},sharp:{en:"Sharp",ja:"鋭い"},shy:{en:"Shy",ja:"恥ずかし"},side:{en:"Side",ja:"サイド"},simple:{en:"Simple",ja:"シンプル"},sleep:{en:"Sleep",ja:"眠り"},snap:{en:"Snap",ja:"スナップ"},spin:{en:"Spin",ja:"スピン"},spirals:{en:"Spirals",ja:"スパイラル"},square:{en:"Square",ja:"スクエア"},stumble:{en:"Stumble",ja:"つまずき"},success:{en:"Success",ja:"成功"},surprised:{en:"Surprised",ja:"驚き"},sway:{en:"Sway",ja:"スウェイ"},swing:{en:"Swing",ja:"スイング"},thoughtful:{en:"Thoughtful",ja:"思案"},tilt:{en:"Tilt",ja:"チルト"},tired:{en:"Tired",ja:"疲れ"},to:{en:"to",ja:"へ"},uh:{en:"Uh",ja:"アッ"},uncertain:{en:"Uncertain",ja:"不確か"},uncomfortable:{en:"Uncomfortable",ja:"居心地悪い"},understanding:{en:"Understanding",ja:"理解"},welcoming:{en:"Welcoming",ja:"歓迎"},yeah:{en:"Yeah",ja:"イエー"},yes:{en:"Yes",ja:"はい"}},D=(o,e)=>`${o}${R}${e}`,F=o=>{if(!o)return{dataset:w,move:f[0]};if(o.includes(R)){const[e,t]=o.split(R);if(e&&t)return{dataset:e,move:t}}return{dataset:w,move:o.trim()||f[0]}},Y=()=>[...f.map(o=>({dataset:w,move:o})),...P.map(o=>({dataset:_,move:o}))],G=o=>o.split("_").flatMap(e=>{const t=e.toLowerCase(),n=t.match(/^([a-z]+)(\d+)?$/);if(!n)return[t];const[,a,i]=n,c=a??"",l=[];return c&&l.push(c),i&&l.push(i),l.length>0?l:[t]}),$=o=>o.length===0?o:o.charAt(0).toUpperCase()+o.slice(1),B=(o,e)=>{const t=G(o);return e==="ja"?t.map(n=>C[n]?.ja??n).join(" "):t.map(n=>C[n]?.en??$(n)).join(" ")};class V{constructor(){U(),this.state={connectionStatus:"disconnected",apiBaseUrl:"http://localhost:8000/api",currentMoveUuid:null,lastKnownState:null,lastStateUpdate:null}}getInfo(){const e=A(),t=Y().map(({dataset:a,move:i})=>{const c=H[a],l=c?r(c):a,y=B(i,e);return{text:`${l}: ${y}`,value:D(a,i)}}),n=D(w,f[0]);return{id:"reachymini",name:r("reachymini.extension.name"),color1:"#4C97FF",color2:"#3373CC",color3:"#2E5BA6",blocks:[{opcode:"wakeUp",blockType:"command",text:r("reachymini.blocks.wakeUp")},{opcode:"gotoSleep",blockType:"command",text:r("reachymini.blocks.gotoSleep")},{opcode:"playRecordedMoveDataset",blockType:"command",text:r("reachymini.blocks.playRecordedMove"),arguments:{MOVE:{type:"string",menu:"recordedMove",defaultValue:n}}},"---",{opcode:"moveHeadDirection",blockType:"command",text:r("reachymini.blocks.moveHeadDirection"),arguments:{DIRECTION:{type:"string",menu:"headDirection",defaultValue:"CENTER"},DURATION:{type:"number",defaultValue:2}}},{opcode:"moveHeadCustom",blockType:"command",text:r("reachymini.blocks.moveHeadCustom"),arguments:{PITCH:{type:"number",defaultValue:0},YAW:{type:"number",defaultValue:0},ROLL:{type:"number",defaultValue:0},DURATION:{type:"number",defaultValue:2}}},{opcode:"performPresetMotion",blockType:"command",text:r("reachymini.blocks.performPresetMotion"),arguments:{MOTION:{type:"string",menu:"motionPreset",defaultValue:"HEAD_NOD"},CYCLES:{type:"number",defaultValue:1}}},"---",{opcode:"moveAntennas",blockType:"command",text:r("reachymini.blocks.moveAntennas"),arguments:{LEFT:{type:"number",defaultValue:0},RIGHT:{type:"number",defaultValue:0},DURATION:{type:"number",defaultValue:2}}},{opcode:"moveAntennasBoth",blockType:"command",text:r("reachymini.blocks.moveAntennasBoth"),arguments:{ANGLE:{type:"number",defaultValue:0},DURATION:{type:"number",defaultValue:2}}},"---",{opcode:"moveBodyYaw",blockType:"command",text:r("reachymini.blocks.moveBodyYaw"),arguments:{ANGLE:{type:"number",defaultValue:0},DURATION:{type:"number",defaultValue:2}}},"---",{opcode:"setMotorMode",blockType:"command",text:r("reachymini.blocks.setMotorMode"),arguments:{MODE:{type:"string",menu:"motorMode",defaultValue:"enabled"}}},"---",{opcode:"getHeadPitch",blockType:"reporter",text:r("reachymini.blocks.getHeadPitch")},{opcode:"getHeadYaw",blockType:"reporter",text:r("reachymini.blocks.getHeadYaw")},{opcode:"getHeadRoll",blockType:"reporter",text:r("reachymini.blocks.getHeadRoll")},{opcode:"getLeftAntenna",blockType:"reporter",text:r("reachymini.blocks.getLeftAntenna")},{opcode:"getRightAntenna",blockType:"reporter",text:r("reachymini.blocks.getRightAntenna")},{opcode:"getBodyYaw",blockType:"reporter",text:r("reachymini.blocks.getBodyYaw")},{opcode:"getMotorMode",blockType:"reporter",text:r("reachymini.blocks.getMotorMode")},"---",{opcode:"isDaemonConnected",blockType:"Boolean",text:r("reachymini.blocks.isDaemonConnected")}],menus:{headDirection:{acceptReporters:!0,items:[{text:r("reachymini.menus.headDirection.center"),value:"CENTER"},{text:r("reachymini.menus.headDirection.up"),value:"UP"},{text:r("reachymini.menus.headDirection.down"),value:"DOWN"},{text:r("reachymini.menus.headDirection.left"),value:"LEFT"},{text:r("reachymini.menus.headDirection.right"),value:"RIGHT"},{text:r("reachymini.menus.headDirection.upLeft"),value:"UP_LEFT"},{text:r("reachymini.menus.headDirection.upRight"),value:"UP_RIGHT"},{text:r("reachymini.menus.headDirection.downLeft"),value:"DOWN_LEFT"},{text:r("reachymini.menus.headDirection.downRight"),value:"DOWN_RIGHT"}]},recordedMove:{acceptReporters:!0,items:t.length>0?t:[{text:r("reachymini.menus.recordedMove.empty"),value:D(w,f[0])}]},motionPreset:{acceptReporters:!0,items:[{text:r("reachymini.menus.motionPreset.headNod"),value:"HEAD_NOD"},{text:r("reachymini.menus.motionPreset.headShake"),value:"HEAD_SHAKE"},{text:r("reachymini.menus.motionPreset.antennaWave"),value:"ANTENNA_WAVE"},{text:r("reachymini.menus.motionPreset.bodySway"),value:"BODY_SWAY"}]},motorMode:{acceptReporters:!0,items:[{text:r("reachymini.menus.motorMode.enabled"),value:"enabled"},{text:r("reachymini.menus.motorMode.disabled"),value:"disabled"},{text:r("reachymini.menus.motorMode.gravityComp"),value:"gravity_compensation"}]}}}}async wakeUp(){try{const e=await m.wakeUp();this.state.currentMoveUuid=e.uuid,await d(300);const t=1e4,n=200,a=Date.now();for(;Date.now()-a<t;){if(!await m.isMovementRunning()){await d(200);return}await d(n)}console.warn("Wake up animation did not complete within timeout")}catch(e){throw console.error("Failed to wake up robot:",e),e}}async gotoSleep(){try{const e=await m.gotoSleep();this.state.currentMoveUuid=e.uuid,await d(300);const t=1e4,n=200,a=Date.now();for(;Date.now()-a<t;){if(!await m.isMovementRunning()){await d(200);return}await d(n)}console.warn("Go to sleep animation did not complete within timeout")}catch(e){throw console.error("Failed to put robot to sleep:",e),e}}async playRecordedMoveDataset(e){try{const{dataset:t,move:n}=F(e.MOVE),a=await m.playRecordedMove(t,n);this.state.currentMoveUuid=a.uuid,await d(300);const i=6e4,c=300,l=Date.now();for(;Date.now()-l<i;){if(!await m.isMovementRunning()){await d(200);return}await d(c)}console.warn("Recorded move did not complete within timeout")}catch(t){throw console.error("Failed to play recorded move dataset:",t),t}}async moveHeadDirection(e){try{const t=e.DIRECTION,n=Math.max(.1,Number(e.DURATION)),a=I[t];if(!a)throw new Error(`Invalid direction: ${t}`);const i=await m.goto({head_pose:{x:0,y:0,z:0,pitch:a.pitch,yaw:a.yaw,roll:a.roll},body_yaw:0,duration:n,interpolation:"minjerk"});this.state.currentMoveUuid=i.uuid,await d(n*1e3+200)}catch(t){throw console.error("Failed to move head:",t),t}}async moveHeadCustom(e){try{const t=s(Number(e.PITCH)),n=s(Number(e.YAW)),a=s(Number(e.ROLL)),i=Math.max(.1,Number(e.DURATION)),c=await m.goto({head_pose:{x:0,y:0,z:0,pitch:t,yaw:n,roll:a},body_yaw:0,duration:i,interpolation:"minjerk"});this.state.currentMoveUuid=c.uuid,await d(i*1e3+200)}catch(t){throw console.error("Failed to move head with custom angles:",t),t}}async performPresetMotion(e){try{const t=e.MOTION??"HEAD_NOD",n=L[t];if(!n)throw new Error(`Invalid preset motion: ${t}`);const a=Number(e.CYCLES),i=Number.isFinite(a)?Math.max(1,Math.floor(a)):1;for(let c=0;c<i;c+=1)for(const l of n.steps){const y=Math.max(.1,l.duration),u={duration:y,interpolation:n.interpolation};if(l.head&&(u.head_pose=x(l.head)),l.antennas&&(u.antennas=l.antennas),typeof l.bodyYaw=="number"&&(u.body_yaw=l.bodyYaw),!u.head_pose&&!u.antennas&&typeof u.body_yaw!="number"){await d(y*1e3);continue}const M=await m.goto(u);this.state.currentMoveUuid=M.uuid,await this.waitForMotionCompletion(y)}}catch(t){throw console.error("Failed to run preset motion:",t),t}}async moveAntennas(e){try{const t=s(Number(e.LEFT)),n=s(Number(e.RIGHT)),a=Math.max(.1,Number(e.DURATION)),i=await m.goto({antennas:[t,n],duration:a,interpolation:"minjerk"});this.state.currentMoveUuid=i.uuid,await d(a*1e3+200)}catch(t){throw console.error("Failed to move antennas:",t),t}}async moveAntennasBoth(e){try{const t=s(Number(e.ANGLE)),n=Math.max(.1,Number(e.DURATION)),a=await m.goto({antennas:[t,t],duration:n,interpolation:"minjerk"});this.state.currentMoveUuid=a.uuid,await d(n*1e3+200)}catch(t){throw console.error("Failed to move both antennas:",t),t}}async moveBodyYaw(e){try{const t=s(Number(e.ANGLE)),n=Math.max(.1,Number(e.DURATION)),a=await m.goto({body_yaw:t,duration:n,interpolation:"minjerk"});this.state.currentMoveUuid=a.uuid,await d(n*1e3+200)}catch(t){throw console.error("Failed to move body yaw:",t),t}}async setMotorMode(e){try{const t=e.MODE;await m.setMotorMode(t)}catch(t){throw console.error("Failed to set motor mode:",t),t}}async getHeadPitch(){try{return await this.updateStateCache(),this.state.lastKnownState?.headPitch?p(this.state.lastKnownState.headPitch):0}catch(e){return console.error("Failed to get head pitch:",e),0}}async getHeadYaw(){try{return await this.updateStateCache(),this.state.lastKnownState?.headYaw?p(this.state.lastKnownState.headYaw):0}catch(e){return console.error("Failed to get head yaw:",e),0}}async getHeadRoll(){try{return await this.updateStateCache(),this.state.lastKnownState?.headRoll?p(this.state.lastKnownState.headRoll):0}catch(e){return console.error("Failed to get head roll:",e),0}}async getLeftAntenna(){try{return await this.updateStateCache(),this.state.lastKnownState?.leftAntenna?p(this.state.lastKnownState.leftAntenna):0}catch(e){return console.error("Failed to get left antenna angle:",e),0}}async getRightAntenna(){try{return await this.updateStateCache(),this.state.lastKnownState?.rightAntenna?p(this.state.lastKnownState.rightAntenna):0}catch(e){return console.error("Failed to get right antenna angle:",e),0}}async getBodyYaw(){try{return await this.updateStateCache(),this.state.lastKnownState?.bodyYaw?p(this.state.lastKnownState.bodyYaw):0}catch(e){return console.error("Failed to get body yaw:",e),0}}async getMotorMode(){try{return await this.updateStateCache(),this.state.lastKnownState?.motorMode??"unknown"}catch(e){return console.error("Failed to get motor mode:",e),"unknown"}}async isDaemonConnected(){try{const e=await m.ping();return this.state.connectionStatus=e?"connected":"disconnected",e}catch{return this.state.connectionStatus="error",!1}}async waitForMotionCompletion(e){const t=e*1e3+150;await d(t);const n=2e3,a=120,i=Date.now();for(;Date.now()-i<n;){try{if(!await m.isMovementRunning()){await d(100);return}}catch(c){console.warn("Failed to verify movement completion:",c);return}await d(a)}console.warn("Movement still running after waitForMotionCompletion timeout")}async updateStateCache(){try{const e=await m.getFullState(),t=await m.getMotorStatus(),n=e.head_pose;let a=0,i=0,c=0;n&&"pitch"in n&&(a=n.pitch??0,i=n.yaw??0,c=n.roll??0);const l=e.antennas_position??[0,0],y=l[0]??0,u=l[1]??0,M=e.body_yaw??0;this.state.lastKnownState={headPitch:a,headYaw:i,headRoll:c,leftAntenna:y,rightAntenna:u,bodyYaw:M,motorMode:t.mode},this.state.lastStateUpdate=Date.now(),this.state.connectionStatus="connected"}catch(e){throw console.error("Failed to update state cache:",e),this.state.connectionStatus="error",e}}}(function(o){if(!o||!o.extensions)throw new Error("This extension must be run in a Scratch 3.0 environment");o.extensions.register(new V)})(Scratch)})();
//# sourceMappingURL=extension.js.map
