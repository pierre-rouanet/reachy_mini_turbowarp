{"version":3,"file":"extension.js","sources":["../src/api/client.ts","../src/utils/angle.ts","../src/utils/sleep.ts","../src/extension.ts","../src/index.ts"],"sourcesContent":["/**\n * REST API client for Reachy Mini daemon\n * Provides type-safe API calls with error handling\n */\n\nimport type {\n  DaemonStatus,\n  FullState,\n  GotoRequest,\n  MotorControlMode,\n  MotorStatus,\n  MoveUUID,\n  StatusResponse,\n} from '../types/api.js';\n\nconst LOCALHOST_HOSTNAMES = new Set(['localhost', '127.0.0.1', '::1', '[::1]']);\n\nconst sanitizeBaseUrl = (rawUrl: string): string => {\n  try {\n    const parsed = new URL(rawUrl);\n    if (!LOCALHOST_HOSTNAMES.has(parsed.hostname)) {\n      throw new Error(\n        `[ReachyMiniApiClient] Base URL must point to localhost (received ${parsed.hostname})`\n      );\n    }\n    // Remove trailing slashes for consistency\n    const normalizedPath = parsed.pathname.replace(/\\/+$/, '');\n    parsed.pathname = normalizedPath.length > 0 ? normalizedPath : '';\n    return parsed.toString().replace(/\\/+$/, '');\n  } catch (error) {\n    if (error instanceof Error) {\n      throw new Error(`[ReachyMiniApiClient] Invalid base URL: ${error.message}`);\n    }\n    throw new Error('[ReachyMiniApiClient] Invalid base URL');\n  }\n};\n\nconst encodeDatasetPath = (rawDatasetName: string): string => {\n  const trimmed = rawDatasetName.trim().replace(/^\\/+|\\/+$/g, '');\n  if (trimmed.length === 0) {\n    throw new Error('[ReachyMiniApiClient] Dataset name is required');\n  }\n\n  return trimmed\n    .split('/')\n    .map((segment) => encodeURIComponent(segment))\n    .join('/');\n};\n\n// ============================================================================\n// Configuration\n// ============================================================================\n\n/**\n * Default API configuration\n */\nexport const DEFAULT_API_CONFIG = {\n  baseUrl: 'http://localhost:8000/api',\n  timeout: 30000, // 30 seconds (needed for simulator movements)\n} as const;\n\n/**\n * API client configuration\n */\nexport interface ApiConfig {\n  baseUrl: string;\n  timeout: number;\n}\n\n// ============================================================================\n// Error Handling\n// ============================================================================\n\n/**\n * API error class\n */\nexport class ApiError extends Error {\n  constructor(\n    message: string,\n    public statusCode?: number,\n    public originalError?: Error\n  ) {\n    super(message);\n    this.name = 'ApiError';\n  }\n}\n\n// ============================================================================\n// HTTP Request Helper\n// ============================================================================\n\n/**\n * Makes an HTTP request with timeout and error handling\n */\nasync function makeRequest<T>(url: string, options: RequestInit, timeout: number): Promise<T> {\n  const controller = new AbortController();\n  const timeoutId = setTimeout(() => controller.abort(), timeout);\n\n  try {\n    const response = await fetch(url, {\n      ...options,\n      signal: controller.signal,\n    });\n\n    clearTimeout(timeoutId);\n\n    if (!response.ok) {\n      throw new ApiError(`HTTP error! status: ${response.status}`, response.status);\n    }\n\n    const data = await response.json();\n    return data as T;\n  } catch (error) {\n    clearTimeout(timeoutId);\n\n    if (error instanceof ApiError) {\n      throw error;\n    }\n\n    if (error instanceof Error) {\n      if (error.name === 'AbortError') {\n        throw new ApiError('Request timeout', undefined, error);\n      }\n      throw new ApiError(`Network error: ${error.message}`, undefined, error);\n    }\n\n    throw new ApiError('Unknown error occurred');\n  }\n}\n\n// ============================================================================\n// API Client Class\n// ============================================================================\n\n/**\n * Reachy Mini API client\n */\nexport class ReachyMiniApiClient {\n  private config: ApiConfig;\n\n  constructor(config: Partial<ApiConfig> = {}) {\n    const baseUrl = sanitizeBaseUrl(config.baseUrl ?? DEFAULT_API_CONFIG.baseUrl);\n    this.config = {\n      baseUrl,\n      timeout: config.timeout ?? DEFAULT_API_CONFIG.timeout,\n    };\n  }\n\n  /**\n   * Updates the API configuration\n   */\n  updateConfig(config: Partial<ApiConfig>): void {\n    const nextBaseUrl = config.baseUrl ? sanitizeBaseUrl(config.baseUrl) : this.config.baseUrl;\n    this.config = {\n      ...this.config,\n      ...config,\n      baseUrl: nextBaseUrl,\n    };\n  }\n\n  /**\n   * Gets the current base URL\n   */\n  getBaseUrl(): string {\n    return this.config.baseUrl;\n  }\n\n  // ==========================================================================\n  // Movement Control\n  // ==========================================================================\n\n  /**\n   * Wakes up the robot (pre-programmed animation)\n   */\n  async wakeUp(): Promise<MoveUUID> {\n    const url = `${this.config.baseUrl}/move/play/wake_up`;\n    return makeRequest<MoveUUID>(\n      url,\n      {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n      },\n      this.config.timeout\n    );\n  }\n\n  /**\n   * Puts the robot to sleep (pre-programmed animation)\n   */\n  async gotoSleep(): Promise<MoveUUID> {\n    const url = `${this.config.baseUrl}/move/play/goto_sleep`;\n    return makeRequest<MoveUUID>(\n      url,\n      {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n      },\n      this.config.timeout\n    );\n  }\n\n  /**\n   * Moves the robot to a specified pose\n   */\n  async goto(request: GotoRequest): Promise<MoveUUID> {\n    const url = `${this.config.baseUrl}/move/goto`;\n    const payload: GotoRequest = { ...request };\n\n    // Reachy Mini daemon uses opposite yaw sign convention for the body.\n    // Flip here so positive inputs from TurboWarp/UI produce positive readings.\n    if (typeof payload.body_yaw === 'number') {\n      payload.body_yaw = -payload.body_yaw;\n    }\n\n    return makeRequest<MoveUUID>(\n      url,\n      {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(payload),\n      },\n      this.config.timeout\n    );\n  }\n\n  /**\n   * Checks if a movement is currently running\n   */\n  async isMovementRunning(): Promise<boolean> {\n    const url = `${this.config.baseUrl}/move/running`;\n    const response = await makeRequest<string[]>(\n      url,\n      {\n        method: 'GET',\n        headers: { 'Content-Type': 'application/json' },\n      },\n      this.config.timeout\n    );\n    // Returns array of running movement UUIDs, empty if none\n    return response.length > 0;\n  }\n\n  /**\n   * Stops all current movements\n   */\n  async stopMovement(): Promise<StatusResponse> {\n    const url = `${this.config.baseUrl}/move/stop`;\n    return makeRequest<StatusResponse>(\n      url,\n      {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n      },\n      this.config.timeout\n    );\n  }\n\n  /**\n   * Lists recorded moves available in a dataset\n   */\n  async listRecordedMoves(datasetName: string): Promise<string[]> {\n    const datasetSegment = encodeDatasetPath(datasetName);\n    const url = `${this.config.baseUrl}/move/recorded-move-datasets/list/${datasetSegment}`;\n    return makeRequest<string[]>(\n      url,\n      {\n        method: 'GET',\n        headers: { 'Content-Type': 'application/json' },\n      },\n      this.config.timeout\n    );\n  }\n\n  /**\n   * Plays a recorded move from a dataset\n   */\n  async playRecordedMove(datasetName: string, moveName: string): Promise<MoveUUID> {\n    const datasetSegment = encodeDatasetPath(datasetName);\n    const moveSegment = encodeURIComponent(moveName);\n    const url = `${this.config.baseUrl}/move/play/recorded-move-dataset/${datasetSegment}/${moveSegment}`;\n    return makeRequest<MoveUUID>(\n      url,\n      {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n      },\n      this.config.timeout\n    );\n  }\n\n  // ==========================================================================\n  // State Queries\n  // ==========================================================================\n\n  /**\n   * Gets the full robot state\n   */\n  async getFullState(): Promise<FullState> {\n    const url = `${this.config.baseUrl}/state/full`;\n    return makeRequest<FullState>(\n      url,\n      {\n        method: 'GET',\n        headers: { 'Content-Type': 'application/json' },\n      },\n      this.config.timeout\n    );\n  }\n\n  /**\n   * Gets the current head pose\n   */\n  async getHeadPose(): Promise<{\n    x: number;\n    y: number;\n    z: number;\n    roll: number;\n    pitch: number;\n    yaw: number;\n  }> {\n    const url = `${this.config.baseUrl}/state/present_head_pose`;\n    return makeRequest<{\n      x: number;\n      y: number;\n      z: number;\n      roll: number;\n      pitch: number;\n      yaw: number;\n    }>(\n      url,\n      {\n        method: 'GET',\n        headers: { 'Content-Type': 'application/json' },\n      },\n      this.config.timeout\n    );\n  }\n\n  /**\n   * Gets the current body yaw angle\n   */\n  async getBodyYaw(): Promise<number> {\n    const url = `${this.config.baseUrl}/state/present_body_yaw`;\n    return makeRequest<number>(\n      url,\n      {\n        method: 'GET',\n        headers: { 'Content-Type': 'application/json' },\n      },\n      this.config.timeout\n    );\n  }\n\n  /**\n   * Gets the current antenna positions\n   */\n  async getAntennaPositions(): Promise<[number, number]> {\n    const url = `${this.config.baseUrl}/state/present_antenna_joint_positions`;\n    return makeRequest<[number, number]>(\n      url,\n      {\n        method: 'GET',\n        headers: { 'Content-Type': 'application/json' },\n      },\n      this.config.timeout\n    );\n  }\n\n  // ==========================================================================\n  // Motor Control\n  // ==========================================================================\n\n  /**\n   * Gets the current motor status\n   */\n  async getMotorStatus(): Promise<MotorStatus> {\n    const url = `${this.config.baseUrl}/motors/status`;\n    return makeRequest<MotorStatus>(\n      url,\n      {\n        method: 'GET',\n        headers: { 'Content-Type': 'application/json' },\n      },\n      this.config.timeout\n    );\n  }\n\n  /**\n   * Sets the motor control mode\n   */\n  async setMotorMode(mode: MotorControlMode): Promise<StatusResponse> {\n    const url = `${this.config.baseUrl}/motors/set_mode/${mode}`;\n    return makeRequest<StatusResponse>(\n      url,\n      {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n      },\n      this.config.timeout\n    );\n  }\n\n  // ==========================================================================\n  // Daemon Status\n  // ==========================================================================\n\n  /**\n   * Gets the daemon status\n   */\n  async getDaemonStatus(): Promise<DaemonStatus> {\n    const url = `${this.config.baseUrl}/daemon/status`;\n    return makeRequest<DaemonStatus>(\n      url,\n      {\n        method: 'GET',\n        headers: { 'Content-Type': 'application/json' },\n      },\n      this.config.timeout\n    );\n  }\n\n  /**\n   * Checks if the daemon is reachable\n   */\n  async ping(): Promise<boolean> {\n    try {\n      await this.getDaemonStatus();\n      return true;\n    } catch {\n      return false;\n    }\n  }\n}\n\n// ============================================================================\n// Singleton Instance (default)\n// ============================================================================\n\n/**\n * Default API client instance\n */\nexport const apiClient = new ReachyMiniApiClient();\n","/**\n * Angle conversion utilities\n *\n * TurboWarp (Scratch) blocks use degrees\n * Reachy Mini REST API uses radians\n */\n\n/**\n * Convert degrees to radians\n * @param degrees - Angle in degrees\n * @returns Angle in radians\n */\nexport function degToRad(degrees: number): number {\n  return (degrees * Math.PI) / 180;\n}\n\n/**\n * Convert radians to degrees\n * @param radians - Angle in radians\n * @returns Angle in degrees\n */\nexport function radToDeg(radians: number): number {\n  return (radians * 180) / Math.PI;\n}\n","/**\n * Sleep utility for waiting in async functions\n */\n\n/**\n * Sleeps for the specified duration in milliseconds\n * @param ms Duration in milliseconds\n * @returns Promise that resolves after the specified duration\n */\nexport function sleep(ms: number): Promise<void> {\n  return new Promise((resolve) => setTimeout(resolve, ms));\n}\n","/**\n * Reachy Mini TurboWarp Extension\n * Main extension class implementing Scratch extension interface\n */\n\nimport { apiClient } from './api/client.js';\nimport { degToRad, radToDeg } from './utils/angle.js';\nimport { sleep } from './utils/sleep.js';\nimport type {\n  ExtensionState,\n  HeadDirection,\n  HeadDirectionPresets,\n  PerformPresetMotionArgs,\n  PlayRecordedMoveArgs,\n  PresetMotionDefinition,\n  PresetMotionId,\n} from './types/extension.js';\nimport type { GotoRequest, MotorControlMode, XYZRPYPose } from './types/api.js';\n\n// ============================================================================\n// i18n helpers\n// ============================================================================\n\nconst EN_MESSAGES = {\n  'reachymini.extension.name': 'Reachy Mini',\n  'reachymini.blocks.wakeUp': 'wake up robot',\n  'reachymini.blocks.gotoSleep': 'put robot to sleep',\n  'reachymini.blocks.moveHeadDirection': 'move head [DIRECTION] for [DURATION] seconds',\n  'reachymini.blocks.moveHeadCustom':\n    'move head pitch [PITCH]° yaw [YAW]° roll [ROLL]° for [DURATION]s',\n  'reachymini.blocks.playRecordedMove': 'play recorded move [MOVE]',\n  'reachymini.menus.recordedMove.empty': 'no moves available',\n  'reachymini.blocks.performPresetMotion': 'run preset motion [MOTION] [CYCLES] times',\n  'reachymini.blocks.moveAntennas': 'move antennas left [LEFT]° right [RIGHT]° for [DURATION]s',\n  'reachymini.blocks.moveAntennasBoth': 'move both antennas [ANGLE]° for [DURATION]s',\n  'reachymini.blocks.moveBodyYaw': 'move body yaw [ANGLE]° for [DURATION]s',\n  'reachymini.blocks.setMotorMode': 'set motor mode [MODE]',\n  'reachymini.blocks.getHeadPitch': 'head pitch (degrees)',\n  'reachymini.blocks.getHeadYaw': 'head yaw (degrees)',\n  'reachymini.blocks.getHeadRoll': 'head roll (degrees)',\n  'reachymini.blocks.getLeftAntenna': 'left antenna angle (degrees)',\n  'reachymini.blocks.getRightAntenna': 'right antenna angle (degrees)',\n  'reachymini.blocks.getBodyYaw': 'body yaw (degrees)',\n  'reachymini.blocks.getMotorMode': 'motor mode',\n  'reachymini.blocks.isDaemonConnected': 'daemon connected?',\n  'reachymini.menus.headDirection.center': 'center',\n  'reachymini.menus.headDirection.up': 'up',\n  'reachymini.menus.headDirection.down': 'down',\n  'reachymini.menus.headDirection.left': 'left',\n  'reachymini.menus.headDirection.right': 'right',\n  'reachymini.menus.headDirection.upLeft': 'up left',\n  'reachymini.menus.headDirection.upRight': 'up right',\n  'reachymini.menus.headDirection.downLeft': 'down left',\n  'reachymini.menus.headDirection.downRight': 'down right',\n  'reachymini.menus.motionPreset.headNod': 'head nod',\n  'reachymini.menus.motionPreset.headShake': 'head shake',\n  'reachymini.menus.motionPreset.antennaWave': 'antenna wave',\n  'reachymini.menus.motionPreset.bodySway': 'body sway',\n  'reachymini.menus.recordedDataset.dances': 'dances library',\n  'reachymini.menus.recordedDataset.emotions': 'emotions library',\n  'reachymini.menus.motorMode.enabled': 'enabled',\n  'reachymini.menus.motorMode.disabled': 'disabled',\n  'reachymini.menus.motorMode.gravityComp': 'gravity compensation',\n} as const;\n\ntype MessageId = keyof typeof EN_MESSAGES;\n\nconst JA_MESSAGES: Record<MessageId, string> = {\n  'reachymini.extension.name': 'Reachy Mini',\n  'reachymini.blocks.wakeUp': 'ロボットを起こす',\n  'reachymini.blocks.gotoSleep': 'ロボットを寝かせる',\n  'reachymini.blocks.moveHeadDirection': '頭を [DIRECTION] に [DURATION] 秒動かす',\n  'reachymini.blocks.moveHeadCustom':\n    '頭を pitch [PITCH]° yaw [YAW]° roll [ROLL]° で [DURATION] 秒動かす',\n  'reachymini.blocks.playRecordedMove': '録画モーション [MOVE] を再生する',\n  'reachymini.menus.recordedMove.empty': 'モーションが見つかりません',\n  'reachymini.blocks.performPresetMotion': 'プリセット動作 [MOTION] を [CYCLES] 回再生する',\n  'reachymini.blocks.moveAntennas': 'アンテナを 左 [LEFT]° 右 [RIGHT]° で [DURATION] 秒動かす',\n  'reachymini.blocks.moveAntennasBoth': '両方のアンテナを [ANGLE]° で [DURATION] 秒動かす',\n  'reachymini.blocks.moveBodyYaw': '胴体を [ANGLE]° で [DURATION] 秒動かす',\n  'reachymini.blocks.setMotorMode': 'モーターを [MODE] モードにする',\n  'reachymini.blocks.getHeadPitch': '頭のピッチ角 (度)',\n  'reachymini.blocks.getHeadYaw': '頭のヨー角 (度)',\n  'reachymini.blocks.getHeadRoll': '頭のロール角 (度)',\n  'reachymini.blocks.getLeftAntenna': '左アンテナ角度 (度)',\n  'reachymini.blocks.getRightAntenna': '右アンテナ角度 (度)',\n  'reachymini.blocks.getBodyYaw': '胴体のヨー角 (度)',\n  'reachymini.blocks.getMotorMode': 'モード',\n  'reachymini.blocks.isDaemonConnected': 'デーモン接続中？',\n  'reachymini.menus.headDirection.center': 'まんなか',\n  'reachymini.menus.headDirection.up': 'うえ',\n  'reachymini.menus.headDirection.down': 'した',\n  'reachymini.menus.headDirection.left': 'ひだり',\n  'reachymini.menus.headDirection.right': 'みぎ',\n  'reachymini.menus.headDirection.upLeft': 'うえ ひだり',\n  'reachymini.menus.headDirection.upRight': 'うえ みぎ',\n  'reachymini.menus.headDirection.downLeft': 'した ひだり',\n  'reachymini.menus.headDirection.downRight': 'した みぎ',\n  'reachymini.menus.motionPreset.headNod': 'うなずく',\n  'reachymini.menus.motionPreset.headShake': '首をふる',\n  'reachymini.menus.motionPreset.antennaWave': 'アンテナをふる',\n  'reachymini.menus.motionPreset.bodySway': 'からだをゆらす',\n  'reachymini.menus.recordedDataset.dances': 'ダンスライブラリ',\n  'reachymini.menus.recordedDataset.emotions': '感情ライブラリ',\n  'reachymini.menus.motorMode.enabled': 'オン',\n  'reachymini.menus.motorMode.disabled': 'オフ',\n  'reachymini.menus.motorMode.gravityComp': '重力補償',\n};\n\nconst TRANSLATIONS: Record<'en' | 'ja', Record<MessageId, string>> = {\n  en: EN_MESSAGES,\n  ja: JA_MESSAGES,\n};\n\ntype ScratchTranslate = {\n  (message: string, variables?: Record<string, string>): string;\n  setup?: (translations: Record<string, Record<string, string>>) => void;\n  language?: string;\n};\n\ntype ScratchGlobal = {\n  translate?: ScratchTranslate;\n  vm?: {\n    runtime?: {\n      getLocale?: () => string;\n    };\n  };\n};\n\nconst getScratch = (): ScratchGlobal | undefined =>\n  (globalThis as { Scratch?: ScratchGlobal }).Scratch;\n\nconst setupTranslations = (): void => {\n  const scratch = getScratch();\n  if (!scratch || typeof scratch.translate !== 'function') {\n    return;\n  }\n\n  const translateFn = scratch.translate;\n  const currentLanguage = translateFn.language ?? 'unknown';\n  const runtimeLocale = scratch.vm?.runtime?.getLocale?.();\n  console.warn('[ReachyMiniExtension] Translation setup', {\n    scratchTranslateLanguage: currentLanguage,\n    runtimeLocale: runtimeLocale ?? 'unavailable',\n  });\n\n  if (typeof translateFn.setup === 'function') {\n    translateFn.setup(TRANSLATIONS);\n  }\n};\n\nconst resolveLocale = (): keyof typeof TRANSLATIONS => {\n  const scratch = getScratch();\n  const runtimeLocale = scratch?.vm?.runtime?.getLocale?.();\n  if (runtimeLocale && runtimeLocale in TRANSLATIONS) {\n    return runtimeLocale as keyof typeof TRANSLATIONS;\n  }\n\n  const translatorLocale = scratch?.translate?.language;\n  if (translatorLocale && translatorLocale in TRANSLATIONS) {\n    return translatorLocale as keyof typeof TRANSLATIONS;\n  }\n\n  return 'en';\n};\n\nconst formatMessage = (id: MessageId): string => {\n  const locale = resolveLocale();\n  const messages = TRANSLATIONS[locale] ?? EN_MESSAGES;\n  return messages[id] ?? EN_MESSAGES[id];\n};\n\n// ============================================================================\n// Constants\n// ============================================================================\n\n/**\n * Head direction presets (in radians)\n * NOTE: Actual robot coordinate system is inverted from documentation\n * - Negative pitch: look up\n * - Positive pitch: look down\n */\nconst HEAD_DIRECTION_PRESETS: HeadDirectionPresets = {\n  UP: { pitch: -0.3, yaw: 0, roll: 0 },\n  DOWN: { pitch: 0.3, yaw: 0, roll: 0 },\n  LEFT: { pitch: 0, yaw: 0.5, roll: 0 },\n  RIGHT: { pitch: 0, yaw: -0.5, roll: 0 },\n  UP_LEFT: { pitch: -0.3, yaw: 0.5, roll: 0 },\n  UP_RIGHT: { pitch: -0.3, yaw: -0.5, roll: 0 },\n  DOWN_LEFT: { pitch: 0.3, yaw: 0.5, roll: 0 },\n  DOWN_RIGHT: { pitch: 0.3, yaw: -0.5, roll: 0 },\n  CENTER: { pitch: 0, yaw: 0, roll: 0 },\n};\n\n/**\n * Base pose used when composing preset head targets\n */\nconst BASE_HEAD_POSE: XYZRPYPose = {\n  x: 0,\n  y: 0,\n  z: 0,\n  roll: 0,\n  pitch: 0,\n  yaw: 0,\n};\n\n/**\n * Predefined motion presets inspired by the Python examples\n */\nconst PRESET_MOTIONS: Record<PresetMotionId, PresetMotionDefinition> = {\n  HEAD_NOD: {\n    interpolation: 'ease',\n    steps: [\n      { head: { pitch: degToRad(-12) }, duration: 0.35 },\n      { head: { pitch: degToRad(12) }, duration: 0.35 },\n      { head: { pitch: 0 }, duration: 0.3 },\n    ],\n  },\n  HEAD_SHAKE: {\n    interpolation: 'ease',\n    steps: [\n      { head: { yaw: degToRad(15) }, duration: 0.35 },\n      { head: { yaw: degToRad(-15) }, duration: 0.35 },\n      { head: { yaw: 0 }, duration: 0.3 },\n    ],\n  },\n  ANTENNA_WAVE: {\n    interpolation: 'minjerk',\n    steps: [\n      { antennas: [degToRad(18), degToRad(-18)], duration: 0.4 },\n      { antennas: [degToRad(-18), degToRad(18)], duration: 0.4 },\n      { antennas: [0, 0], duration: 0.3 },\n    ],\n  },\n  BODY_SWAY: {\n    interpolation: 'cartoon',\n    steps: [\n      { head: { yaw: degToRad(5) }, bodyYaw: degToRad(8), duration: 0.45 },\n      { head: { yaw: degToRad(-5) }, bodyYaw: degToRad(-8), duration: 0.45 },\n      { head: { yaw: 0 }, bodyYaw: 0, duration: 0.3 },\n    ],\n  },\n};\n\n/**\n * Builds a complete head pose merged with the base pose\n */\nconst buildHeadPose = (overrides?: Partial<XYZRPYPose>): XYZRPYPose => ({\n  x: overrides?.x ?? BASE_HEAD_POSE.x,\n  y: overrides?.y ?? BASE_HEAD_POSE.y,\n  z: overrides?.z ?? BASE_HEAD_POSE.z,\n  roll: overrides?.roll ?? BASE_HEAD_POSE.roll,\n  pitch: overrides?.pitch ?? BASE_HEAD_POSE.pitch,\n  yaw: overrides?.yaw ?? BASE_HEAD_POSE.yaw,\n});\n\n/**\n * Default recorded dataset references used in menus\n */\nconst DEFAULT_RECORDED_DATASET = 'pollen-robotics/reachy-mini-dances-library';\nconst EMOTIONS_RECORDED_DATASET = 'pollen-robotics/reachy-mini-emotions-library';\nconst DANCE_RECORDED_MOVES = [\n  'groovy_sway_and_roll',\n  'headbanger_combo',\n  'uh_huh_tilt',\n  'side_to_side_sway',\n  'dizzy_spin',\n  'neck_recoil',\n  'jackson_square',\n  'side_peekaboo',\n  'sharp_side_tilt',\n  'chin_lead',\n  'stumble_and_recover',\n  'head_tilt_roll',\n  'yeah_nod',\n  'interwoven_spirals',\n  'chicken_peck',\n  'simple_nod',\n  'polyrhythm_combo',\n  'grid_snap',\n  'side_glance_flick',\n  'pendulum_swing',\n] as const;\nconst EMOTIONS_RECORDED_MOVES = [\n  'dance3',\n  'displeased1',\n  'welcoming1',\n  'surprised1',\n  'reprimand3',\n  'dance1',\n  'disgusted1',\n  'curious1',\n  'contempt1',\n  'sad2',\n  'thoughtful2',\n  'enthusiastic2',\n  'understanding1',\n  'amazed1',\n  'impatient2',\n  'success2',\n  'grateful1',\n  'scared1',\n  'inquiring2',\n  'success1',\n  'indifferent1',\n  'displeased2',\n  'thoughtful1',\n  'reprimand2',\n  'fear1',\n  'no1',\n  'cheerful1',\n  'shy1',\n  'downcast1',\n  'boredom1',\n  'laughing1',\n  'irritated1',\n  'lost1',\n  'frustrated1',\n  'exhausted1',\n  'irritated2',\n  'dance2',\n  'dying1',\n  'confused1',\n  'inquiring1',\n  'proud3',\n  'relief1',\n  'enthusiastic1',\n  'attentive1',\n  'calming1',\n  'reprimand1',\n  'attentive2',\n  'uncertain1',\n  'oops1',\n  'boredom2',\n  'surprised2',\n  'uncomfortable1',\n  'sleep1',\n  'furious1',\n  'resigned1',\n  'helpful1',\n  'proud1',\n  'come1',\n  'go_away1',\n  'lonely1',\n  'yes_sad1',\n  'inquiring3',\n  'incomprehensible2',\n  'electric1',\n  'welcoming2',\n  'rage1',\n  'oops2',\n  'anxiety1',\n  'understanding2',\n  'laughing2',\n  'no_excited1',\n  'helpful2',\n  'relief2',\n  'yes1',\n  'proud2',\n  'sad1',\n  'loving1',\n  'impatient1',\n  'tired1',\n  'serenity1',\n  'no_sad1',\n] as const;\nconst RECORDED_DATASET_LABELS: Record<string, MessageId> = {\n  [DEFAULT_RECORDED_DATASET]: 'reachymini.menus.recordedDataset.dances',\n  [EMOTIONS_RECORDED_DATASET]: 'reachymini.menus.recordedDataset.emotions',\n};\nconst RECORDED_MOVE_VALUE_SEPARATOR = '||';\n\nconst RECORDED_MOVE_WORD_LABELS: Record<string, { en: string; ja: string }> = {\n  '1': { en: '1', ja: '1' },\n  '2': { en: '2', ja: '2' },\n  '3': { en: '3', ja: '3' },\n  amazed: { en: 'Amazed', ja: '驚き' },\n  and: { en: 'and', ja: '＆' },\n  anxiety: { en: 'Anxiety', ja: '不安' },\n  attentive: { en: 'Attentive', ja: '注目' },\n  away: { en: 'Away', ja: '離れて' },\n  boredom: { en: 'Boredom', ja: '退屈' },\n  calming: { en: 'Calming', ja: '落ち着き' },\n  cheerful: { en: 'Cheerful', ja: '陽気' },\n  chicken: { en: 'Chicken', ja: 'チキン' },\n  chin: { en: 'Chin', ja: 'あご' },\n  combo: { en: 'Combo', ja: 'コンボ' },\n  come: { en: 'Come', ja: 'おいで' },\n  confused: { en: 'Confused', ja: '混乱' },\n  contempt: { en: 'Contempt', ja: '軽蔑' },\n  curious: { en: 'Curious', ja: '好奇心' },\n  dance: { en: 'Dance', ja: 'ダンス' },\n  disgusted: { en: 'Disgusted', ja: '嫌悪' },\n  displeased: { en: 'Displeased', ja: '不満' },\n  dizzy: { en: 'Dizzy', ja: 'めまい' },\n  downcast: { en: 'Downcast', ja: 'うつむき' },\n  dying: { en: 'Dying', ja: '弱り' },\n  electric: { en: 'Electric', ja: 'エレクトリック' },\n  enthusiastic: { en: 'Enthusiastic', ja: '熱意' },\n  excited: { en: 'Excited', ja: '興奮' },\n  exhausted: { en: 'Exhausted', ja: '疲労' },\n  fear: { en: 'Fear', ja: '恐れ' },\n  flick: { en: 'Flick', ja: 'フリック' },\n  frustrated: { en: 'Frustrated', ja: 'いら立ち' },\n  furious: { en: 'Furious', ja: '激怒' },\n  glance: { en: 'Glance', ja: 'ちらり' },\n  go: { en: 'Go', ja: '行って' },\n  grateful: { en: 'Grateful', ja: '感謝' },\n  grid: { en: 'Grid', ja: 'グリッド' },\n  groovy: { en: 'Groovy', ja: 'グルーヴィー' },\n  head: { en: 'Head', ja: 'ヘッド' },\n  headbanger: { en: 'Headbanger', ja: 'ヘッドバンガー' },\n  helpful: { en: 'Helpful', ja: '助けたい' },\n  huh: { en: 'Huh', ja: 'ハッ' },\n  impatient: { en: 'Impatient', ja: 'いらだち' },\n  incomprehensible: { en: 'Incomprehensible', ja: '理解不能' },\n  indifferent: { en: 'Indifferent', ja: '無関心' },\n  inquiring: { en: 'Inquiring', ja: '問いかけ' },\n  interwoven: { en: 'Interwoven', ja: '絡み合う' },\n  irritated: { en: 'Irritated', ja: 'イライラ' },\n  jackson: { en: 'Jackson', ja: 'ジャクソン' },\n  laughing: { en: 'Laughing', ja: '笑い' },\n  lead: { en: 'Lead', ja: 'リード' },\n  lonely: { en: 'Lonely', ja: '孤独' },\n  lost: { en: 'Lost', ja: '迷い' },\n  loving: { en: 'Loving', ja: '愛情' },\n  neck: { en: 'Neck', ja: 'ネック' },\n  no: { en: 'No', ja: 'いいえ' },\n  nod: { en: 'Nod', ja: 'うなずき' },\n  oops: { en: 'Oops', ja: 'おっと' },\n  peck: { en: 'Peck', ja: 'つつき' },\n  peekaboo: { en: 'Peekaboo', ja: 'いないいないばあ' },\n  pendulum: { en: 'Pendulum', ja: '振り子' },\n  polyrhythm: { en: 'Polyrhythm', ja: 'ポリリズム' },\n  proud: { en: 'Proud', ja: '誇り' },\n  rage: { en: 'Rage', ja: '激昂' },\n  recoil: { en: 'Recoil', ja: 'のけぞり' },\n  recover: { en: 'Recover', ja: '立て直し' },\n  relief: { en: 'Relief', ja: '安心' },\n  reprimand: { en: 'Reprimand', ja: '叱責' },\n  resigned: { en: 'Resigned', ja: '諦め' },\n  roll: { en: 'Roll', ja: 'ロール' },\n  sad: { en: 'Sad', ja: '悲しみ' },\n  scared: { en: 'Scared', ja: '怖い' },\n  serenity: { en: 'Serenity', ja: '穏やか' },\n  sharp: { en: 'Sharp', ja: '鋭い' },\n  shy: { en: 'Shy', ja: '恥ずかし' },\n  side: { en: 'Side', ja: 'サイド' },\n  simple: { en: 'Simple', ja: 'シンプル' },\n  sleep: { en: 'Sleep', ja: '眠り' },\n  snap: { en: 'Snap', ja: 'スナップ' },\n  spin: { en: 'Spin', ja: 'スピン' },\n  spirals: { en: 'Spirals', ja: 'スパイラル' },\n  square: { en: 'Square', ja: 'スクエア' },\n  stumble: { en: 'Stumble', ja: 'つまずき' },\n  success: { en: 'Success', ja: '成功' },\n  surprised: { en: 'Surprised', ja: '驚き' },\n  sway: { en: 'Sway', ja: 'スウェイ' },\n  swing: { en: 'Swing', ja: 'スイング' },\n  thoughtful: { en: 'Thoughtful', ja: '思案' },\n  tilt: { en: 'Tilt', ja: 'チルト' },\n  tired: { en: 'Tired', ja: '疲れ' },\n  to: { en: 'to', ja: 'へ' },\n  uh: { en: 'Uh', ja: 'アッ' },\n  uncertain: { en: 'Uncertain', ja: '不確か' },\n  uncomfortable: { en: 'Uncomfortable', ja: '居心地悪い' },\n  understanding: { en: 'Understanding', ja: '理解' },\n  welcoming: { en: 'Welcoming', ja: '歓迎' },\n  yeah: { en: 'Yeah', ja: 'イエー' },\n  yes: { en: 'Yes', ja: 'はい' },\n};\n\nconst encodeRecordedMoveSelection = (dataset: string, move: string): string =>\n  `${dataset}${RECORDED_MOVE_VALUE_SEPARATOR}${move}`;\n\nconst decodeRecordedMoveSelection = (value?: string): { dataset: string; move: string } => {\n  if (!value) {\n    return {\n      dataset: DEFAULT_RECORDED_DATASET,\n      move: DANCE_RECORDED_MOVES[0],\n    };\n  }\n\n  if (value.includes(RECORDED_MOVE_VALUE_SEPARATOR)) {\n    const [dataset, move] = value.split(RECORDED_MOVE_VALUE_SEPARATOR);\n    if (dataset && move) {\n      return { dataset, move };\n    }\n  }\n\n  // Fallback for manual input (move name only, assume default dataset)\n  return {\n    dataset: DEFAULT_RECORDED_DATASET,\n    move: value.trim() || DANCE_RECORDED_MOVES[0],\n  };\n};\n\nconst buildRecordedMoveMenuItems = (): { dataset: string; move: string }[] => [\n  ...DANCE_RECORDED_MOVES.map((move) => ({\n    dataset: DEFAULT_RECORDED_DATASET,\n    move,\n  })),\n  ...EMOTIONS_RECORDED_MOVES.map((move) => ({\n    dataset: EMOTIONS_RECORDED_DATASET,\n    move,\n  })),\n];\n\nconst splitRecordedMoveWords = (move: string): string[] =>\n  move.split('_').flatMap((segment) => {\n    const lower = segment.toLowerCase();\n    const match = lower.match(/^([a-z]+)(\\d+)?$/);\n    if (!match) {\n      return [lower];\n    }\n\n    const [, rawWord, number] = match;\n    const baseWord = rawWord ?? '';\n    const entries: string[] = [];\n    if (baseWord) {\n      entries.push(baseWord);\n    }\n    if (number) {\n      entries.push(number);\n    }\n    return entries.length > 0 ? entries : [lower];\n  });\n\nconst capitalizeWord = (word: string): string =>\n  word.length === 0 ? word : word.charAt(0).toUpperCase() + word.slice(1);\n\nconst formatRecordedMoveLabel = (move: string, locale: keyof typeof TRANSLATIONS): string => {\n  const words = splitRecordedMoveWords(move);\n  if (locale === 'ja') {\n    return words.map((word) => RECORDED_MOVE_WORD_LABELS[word]?.ja ?? word).join(' ');\n  }\n\n  return words.map((word) => RECORDED_MOVE_WORD_LABELS[word]?.en ?? capitalizeWord(word)).join(' ');\n};\n\n// ============================================================================\n// Extension Class\n// ============================================================================\n\n/**\n * Reachy Mini TurboWarp Extension\n */\nexport class ReachyMiniExtension {\n  private state: ExtensionState;\n\n  constructor() {\n    setupTranslations();\n\n    this.state = {\n      connectionStatus: 'disconnected',\n      apiBaseUrl: 'http://localhost:8000/api',\n      currentMoveUuid: null,\n      lastKnownState: null,\n      lastStateUpdate: null,\n    };\n  }\n\n  /**\n   * Returns extension metadata and block definitions\n   */\n  getInfo(): ExtensionInfo {\n    const locale = resolveLocale();\n    const recordedMoveMenuItems = buildRecordedMoveMenuItems().map(({ dataset, move }) => {\n      const labelId = RECORDED_DATASET_LABELS[dataset];\n      const datasetLabel = labelId ? formatMessage(labelId) : dataset;\n      const moveLabel = formatRecordedMoveLabel(move, locale);\n      return {\n        text: `${datasetLabel}: ${moveLabel}`,\n        value: encodeRecordedMoveSelection(dataset, move),\n      };\n    });\n    const defaultRecordedMoveValue = encodeRecordedMoveSelection(\n      DEFAULT_RECORDED_DATASET,\n      DANCE_RECORDED_MOVES[0]\n    );\n\n    return {\n      id: 'reachymini',\n      name: formatMessage('reachymini.extension.name'),\n      color1: '#4C97FF',\n      color2: '#3373CC',\n      color3: '#2E5BA6',\n      blocks: [\n        // Basic movements\n        {\n          opcode: 'wakeUp',\n          blockType: 'command',\n          text: formatMessage('reachymini.blocks.wakeUp'),\n        },\n        {\n          opcode: 'gotoSleep',\n          blockType: 'command',\n          text: formatMessage('reachymini.blocks.gotoSleep'),\n        },\n        {\n          opcode: 'playRecordedMoveDataset',\n          blockType: 'command',\n          text: formatMessage('reachymini.blocks.playRecordedMove'),\n          arguments: {\n            MOVE: {\n              type: 'string',\n              menu: 'recordedMove',\n              defaultValue: defaultRecordedMoveValue,\n            },\n          },\n        },\n        '---',\n\n        // Head control - simple\n        {\n          opcode: 'moveHeadDirection',\n          blockType: 'command',\n          text: formatMessage('reachymini.blocks.moveHeadDirection'),\n          arguments: {\n            DIRECTION: {\n              type: 'string',\n              menu: 'headDirection',\n              defaultValue: 'CENTER',\n            },\n            DURATION: {\n              type: 'number',\n              defaultValue: 2,\n            },\n          },\n        },\n\n        // Head control - custom\n        {\n          opcode: 'moveHeadCustom',\n          blockType: 'command',\n          text: formatMessage('reachymini.blocks.moveHeadCustom'),\n          arguments: {\n            PITCH: {\n              type: 'number',\n              defaultValue: 0,\n            },\n            YAW: {\n              type: 'number',\n              defaultValue: 0,\n            },\n            ROLL: {\n              type: 'number',\n              defaultValue: 0,\n            },\n            DURATION: {\n              type: 'number',\n              defaultValue: 2,\n            },\n          },\n        },\n        {\n          opcode: 'performPresetMotion',\n          blockType: 'command',\n          text: formatMessage('reachymini.blocks.performPresetMotion'),\n          arguments: {\n            MOTION: {\n              type: 'string',\n              menu: 'motionPreset',\n              defaultValue: 'HEAD_NOD',\n            },\n            CYCLES: {\n              type: 'number',\n              defaultValue: 1,\n            },\n          },\n        },\n        '---',\n\n        // Antenna control\n        {\n          opcode: 'moveAntennas',\n          blockType: 'command',\n          text: formatMessage('reachymini.blocks.moveAntennas'),\n          arguments: {\n            LEFT: {\n              type: 'number',\n              defaultValue: 0,\n            },\n            RIGHT: {\n              type: 'number',\n              defaultValue: 0,\n            },\n            DURATION: {\n              type: 'number',\n              defaultValue: 2,\n            },\n          },\n        },\n        {\n          opcode: 'moveAntennasBoth',\n          blockType: 'command',\n          text: formatMessage('reachymini.blocks.moveAntennasBoth'),\n          arguments: {\n            ANGLE: {\n              type: 'number',\n              defaultValue: 0,\n            },\n            DURATION: {\n              type: 'number',\n              defaultValue: 2,\n            },\n          },\n        },\n        '---',\n\n        // Body control\n        {\n          opcode: 'moveBodyYaw',\n          blockType: 'command',\n          text: formatMessage('reachymini.blocks.moveBodyYaw'),\n          arguments: {\n            ANGLE: {\n              type: 'number',\n              defaultValue: 0,\n            },\n            DURATION: {\n              type: 'number',\n              defaultValue: 2,\n            },\n          },\n        },\n        '---',\n\n        // Motor control\n        {\n          opcode: 'setMotorMode',\n          blockType: 'command',\n          text: formatMessage('reachymini.blocks.setMotorMode'),\n          arguments: {\n            MODE: {\n              type: 'string',\n              menu: 'motorMode',\n              defaultValue: 'enabled',\n            },\n          },\n        },\n        '---',\n\n        // Reporter blocks (getters)\n        {\n          opcode: 'getHeadPitch',\n          blockType: 'reporter',\n          text: formatMessage('reachymini.blocks.getHeadPitch'),\n        },\n        {\n          opcode: 'getHeadYaw',\n          blockType: 'reporter',\n          text: formatMessage('reachymini.blocks.getHeadYaw'),\n        },\n        {\n          opcode: 'getHeadRoll',\n          blockType: 'reporter',\n          text: formatMessage('reachymini.blocks.getHeadRoll'),\n        },\n        {\n          opcode: 'getLeftAntenna',\n          blockType: 'reporter',\n          text: formatMessage('reachymini.blocks.getLeftAntenna'),\n        },\n        {\n          opcode: 'getRightAntenna',\n          blockType: 'reporter',\n          text: formatMessage('reachymini.blocks.getRightAntenna'),\n        },\n        {\n          opcode: 'getBodyYaw',\n          blockType: 'reporter',\n          text: formatMessage('reachymini.blocks.getBodyYaw'),\n        },\n        {\n          opcode: 'getMotorMode',\n          blockType: 'reporter',\n          text: formatMessage('reachymini.blocks.getMotorMode'),\n        },\n        '---',\n\n        // System\n        {\n          opcode: 'isDaemonConnected',\n          blockType: 'Boolean',\n          text: formatMessage('reachymini.blocks.isDaemonConnected'),\n        },\n      ],\n      menus: {\n        headDirection: {\n          acceptReporters: true,\n          items: [\n            { text: formatMessage('reachymini.menus.headDirection.center'), value: 'CENTER' },\n            { text: formatMessage('reachymini.menus.headDirection.up'), value: 'UP' },\n            { text: formatMessage('reachymini.menus.headDirection.down'), value: 'DOWN' },\n            { text: formatMessage('reachymini.menus.headDirection.left'), value: 'LEFT' },\n            { text: formatMessage('reachymini.menus.headDirection.right'), value: 'RIGHT' },\n            { text: formatMessage('reachymini.menus.headDirection.upLeft'), value: 'UP_LEFT' },\n            { text: formatMessage('reachymini.menus.headDirection.upRight'), value: 'UP_RIGHT' },\n            { text: formatMessage('reachymini.menus.headDirection.downLeft'), value: 'DOWN_LEFT' },\n            {\n              text: formatMessage('reachymini.menus.headDirection.downRight'),\n              value: 'DOWN_RIGHT',\n            },\n          ],\n        },\n        recordedMove: {\n          acceptReporters: true,\n          items:\n            recordedMoveMenuItems.length > 0\n              ? recordedMoveMenuItems\n              : [\n                  {\n                    text: formatMessage('reachymini.menus.recordedMove.empty'),\n                    value: encodeRecordedMoveSelection(\n                      DEFAULT_RECORDED_DATASET,\n                      DANCE_RECORDED_MOVES[0]\n                    ),\n                  },\n                ],\n        },\n        motionPreset: {\n          acceptReporters: true,\n          items: [\n            { text: formatMessage('reachymini.menus.motionPreset.headNod'), value: 'HEAD_NOD' },\n            { text: formatMessage('reachymini.menus.motionPreset.headShake'), value: 'HEAD_SHAKE' },\n            {\n              text: formatMessage('reachymini.menus.motionPreset.antennaWave'),\n              value: 'ANTENNA_WAVE',\n            },\n            { text: formatMessage('reachymini.menus.motionPreset.bodySway'), value: 'BODY_SWAY' },\n          ],\n        },\n        motorMode: {\n          acceptReporters: true,\n          items: [\n            { text: formatMessage('reachymini.menus.motorMode.enabled'), value: 'enabled' },\n            { text: formatMessage('reachymini.menus.motorMode.disabled'), value: 'disabled' },\n            {\n              text: formatMessage('reachymini.menus.motorMode.gravityComp'),\n              value: 'gravity_compensation',\n            },\n          ],\n        },\n      },\n    };\n  }\n\n  // ==========================================================================\n  // Block Implementations - Basic Movements\n  // ==========================================================================\n\n  /**\n   * Wake up the robot\n   * Waits for animation to complete using polling\n   */\n  async wakeUp(): Promise<void> {\n    try {\n      const result = await apiClient.wakeUp();\n      this.state.currentMoveUuid = result.uuid;\n\n      // Wait for animation to start\n      await sleep(300);\n\n      // Poll until animation completes (max 10 seconds)\n      const maxWaitTime = 10000;\n      const pollInterval = 200;\n      const startTime = Date.now();\n\n      while (Date.now() - startTime < maxWaitTime) {\n        const isRunning = await apiClient.isMovementRunning();\n        if (!isRunning) {\n          // Animation complete, wait a bit for settling\n          await sleep(200);\n          return;\n        }\n        await sleep(pollInterval);\n      }\n\n      console.warn('Wake up animation did not complete within timeout');\n    } catch (error) {\n      console.error('Failed to wake up robot:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Put the robot to sleep\n   * Waits for animation to complete using polling\n   */\n  async gotoSleep(): Promise<void> {\n    try {\n      const result = await apiClient.gotoSleep();\n      this.state.currentMoveUuid = result.uuid;\n\n      // Wait for animation to start\n      await sleep(300);\n\n      // Poll until animation completes (max 10 seconds)\n      const maxWaitTime = 10000;\n      const pollInterval = 200;\n      const startTime = Date.now();\n\n      while (Date.now() - startTime < maxWaitTime) {\n        const isRunning = await apiClient.isMovementRunning();\n        if (!isRunning) {\n          // Animation complete, wait a bit for settling\n          await sleep(200);\n          return;\n        }\n        await sleep(pollInterval);\n      }\n\n      console.warn('Go to sleep animation did not complete within timeout');\n    } catch (error) {\n      console.error('Failed to put robot to sleep:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Play a recorded move dataset entry\n   */\n  async playRecordedMoveDataset(args: PlayRecordedMoveArgs): Promise<void> {\n    try {\n      const { dataset, move } = decodeRecordedMoveSelection(args.MOVE);\n\n      const result = await apiClient.playRecordedMove(dataset, move);\n      this.state.currentMoveUuid = result.uuid;\n\n      await sleep(300);\n      const maxWaitTime = 60000;\n      const pollInterval = 300;\n      const startTime = Date.now();\n\n      while (Date.now() - startTime < maxWaitTime) {\n        const isRunning = await apiClient.isMovementRunning();\n        if (!isRunning) {\n          await sleep(200);\n          return;\n        }\n        await sleep(pollInterval);\n      }\n\n      console.warn('Recorded move did not complete within timeout');\n    } catch (error) {\n      console.error('Failed to play recorded move dataset:', error);\n      throw error;\n    }\n  }\n\n  // ==========================================================================\n  // Block Implementations - Head Control\n  // ==========================================================================\n\n  /**\n   * Move head to a predefined direction\n   * Waits for movement to complete\n   */\n  async moveHeadDirection(args: { DIRECTION: HeadDirection; DURATION: number }): Promise<void> {\n    try {\n      const direction = args.DIRECTION as HeadDirection;\n      const duration = Math.max(0.1, Number(args.DURATION));\n      const preset = HEAD_DIRECTION_PRESETS[direction];\n\n      if (!preset) {\n        throw new Error(`Invalid direction: ${direction}`);\n      }\n\n      const result = await apiClient.goto({\n        head_pose: {\n          x: 0,\n          y: 0,\n          z: 0,\n          pitch: preset.pitch,\n          yaw: preset.yaw,\n          roll: preset.roll,\n        },\n        body_yaw: 0, // Explicitly set body_yaw to 0 for predictable head movement\n        duration,\n        interpolation: 'minjerk',\n      });\n\n      this.state.currentMoveUuid = result.uuid;\n      // Wait for movement to complete (duration + 200ms buffer)\n      await sleep(duration * 1000 + 200);\n    } catch (error) {\n      console.error('Failed to move head:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Move head with custom angles (degrees input)\n   * Waits for movement to complete\n   */\n  async moveHeadCustom(args: {\n    PITCH: number;\n    YAW: number;\n    ROLL: number;\n    DURATION: number;\n  }): Promise<void> {\n    try {\n      const pitch = degToRad(Number(args.PITCH));\n      const yaw = degToRad(Number(args.YAW));\n      const roll = degToRad(Number(args.ROLL));\n      const duration = Math.max(0.1, Number(args.DURATION));\n\n      const result = await apiClient.goto({\n        head_pose: {\n          x: 0,\n          y: 0,\n          z: 0,\n          pitch,\n          yaw,\n          roll,\n        },\n        body_yaw: 0, // Explicitly set body_yaw to 0 for predictable head movement\n        duration,\n        interpolation: 'minjerk',\n      });\n\n      this.state.currentMoveUuid = result.uuid;\n      // Wait for movement to complete (duration + 200ms buffer)\n      await sleep(duration * 1000 + 200);\n    } catch (error) {\n      console.error('Failed to move head with custom angles:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Run predefined motion presets for easier animation\n   */\n  async performPresetMotion(args: PerformPresetMotionArgs): Promise<void> {\n    try {\n      const presetId = (args.MOTION as PresetMotionId) ?? 'HEAD_NOD';\n      const preset = PRESET_MOTIONS[presetId];\n      if (!preset) {\n        throw new Error(`Invalid preset motion: ${presetId}`);\n      }\n\n      const cyclesInput = Number(args.CYCLES);\n      const cycles = Number.isFinite(cyclesInput) ? Math.max(1, Math.floor(cyclesInput)) : 1;\n\n      for (let cycle = 0; cycle < cycles; cycle += 1) {\n        for (const step of preset.steps) {\n          const duration = Math.max(0.1, step.duration);\n          const request: GotoRequest = {\n            duration,\n            interpolation: preset.interpolation,\n          };\n\n          if (step.head) {\n            request.head_pose = buildHeadPose(step.head);\n          }\n\n          if (step.antennas) {\n            request.antennas = step.antennas;\n          }\n\n          if (typeof step.bodyYaw === 'number') {\n            request.body_yaw = step.bodyYaw;\n          }\n\n          if (!request.head_pose && !request.antennas && typeof request.body_yaw !== 'number') {\n            await sleep(duration * 1000);\n            continue;\n          }\n\n          const result = await apiClient.goto(request);\n          this.state.currentMoveUuid = result.uuid;\n          await this.waitForMotionCompletion(duration);\n        }\n      }\n    } catch (error) {\n      console.error('Failed to run preset motion:', error);\n      throw error;\n    }\n  }\n\n  // ==========================================================================\n  // Block Implementations - Antenna Control\n  // ==========================================================================\n\n  /**\n   * Move antennas individually (degrees input)\n   * Waits for movement to complete\n   */\n  async moveAntennas(args: { LEFT: number; RIGHT: number; DURATION: number }): Promise<void> {\n    try {\n      const left = degToRad(Number(args.LEFT));\n      const right = degToRad(Number(args.RIGHT));\n      const duration = Math.max(0.1, Number(args.DURATION));\n\n      const result = await apiClient.goto({\n        antennas: [left, right],\n        duration,\n        interpolation: 'minjerk',\n      });\n\n      this.state.currentMoveUuid = result.uuid;\n      // Wait for movement to complete (duration + 200ms buffer)\n      await sleep(duration * 1000 + 200);\n    } catch (error) {\n      console.error('Failed to move antennas:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Move both antennas symmetrically (degrees input)\n   * Waits for movement to complete\n   */\n  async moveAntennasBoth(args: { ANGLE: number; DURATION: number }): Promise<void> {\n    try {\n      const angle = degToRad(Number(args.ANGLE));\n      const duration = Math.max(0.1, Number(args.DURATION));\n\n      const result = await apiClient.goto({\n        antennas: [angle, angle],\n        duration,\n        interpolation: 'minjerk',\n      });\n\n      this.state.currentMoveUuid = result.uuid;\n      // Wait for movement to complete (duration + 200ms buffer)\n      await sleep(duration * 1000 + 200);\n    } catch (error) {\n      console.error('Failed to move both antennas:', error);\n      throw error;\n    }\n  }\n\n  // ==========================================================================\n  // Block Implementations - Body Control\n  // ==========================================================================\n\n  /**\n   * Move body yaw (degrees input)\n   * Waits for movement to complete\n   */\n  async moveBodyYaw(args: { ANGLE: number; DURATION: number }): Promise<void> {\n    try {\n      const bodyYaw = degToRad(Number(args.ANGLE));\n      const duration = Math.max(0.1, Number(args.DURATION));\n\n      const result = await apiClient.goto({\n        body_yaw: bodyYaw,\n        duration,\n        interpolation: 'minjerk',\n      });\n\n      this.state.currentMoveUuid = result.uuid;\n      // Wait for movement to complete (duration + 200ms buffer)\n      await sleep(duration * 1000 + 200);\n    } catch (error) {\n      console.error('Failed to move body yaw:', error);\n      throw error;\n    }\n  }\n\n  // ==========================================================================\n  // Block Implementations - Motor Control\n  // ==========================================================================\n\n  /**\n   * Set motor control mode\n   */\n  async setMotorMode(args: { MODE: MotorControlMode }): Promise<void> {\n    try {\n      const mode = args.MODE as MotorControlMode;\n      await apiClient.setMotorMode(mode);\n    } catch (error) {\n      console.error('Failed to set motor mode:', error);\n      throw error;\n    }\n  }\n\n  // ==========================================================================\n  // Block Implementations - Reporter Blocks\n  // ==========================================================================\n\n  /**\n   * Get current head pitch (degrees)\n   */\n  async getHeadPitch(): Promise<number> {\n    try {\n      await this.updateStateCache();\n      return this.state.lastKnownState?.headPitch\n        ? radToDeg(this.state.lastKnownState.headPitch)\n        : 0;\n    } catch (error) {\n      console.error('Failed to get head pitch:', error);\n      return 0;\n    }\n  }\n\n  /**\n   * Get current head yaw (degrees)\n   */\n  async getHeadYaw(): Promise<number> {\n    try {\n      await this.updateStateCache();\n      return this.state.lastKnownState?.headYaw ? radToDeg(this.state.lastKnownState.headYaw) : 0;\n    } catch (error) {\n      console.error('Failed to get head yaw:', error);\n      return 0;\n    }\n  }\n\n  /**\n   * Get current head roll (degrees)\n   */\n  async getHeadRoll(): Promise<number> {\n    try {\n      await this.updateStateCache();\n      return this.state.lastKnownState?.headRoll ? radToDeg(this.state.lastKnownState.headRoll) : 0;\n    } catch (error) {\n      console.error('Failed to get head roll:', error);\n      return 0;\n    }\n  }\n\n  /**\n   * Get current left antenna angle (degrees)\n   */\n  async getLeftAntenna(): Promise<number> {\n    try {\n      await this.updateStateCache();\n      return this.state.lastKnownState?.leftAntenna\n        ? radToDeg(this.state.lastKnownState.leftAntenna)\n        : 0;\n    } catch (error) {\n      console.error('Failed to get left antenna angle:', error);\n      return 0;\n    }\n  }\n\n  /**\n   * Get current right antenna angle (degrees)\n   */\n  async getRightAntenna(): Promise<number> {\n    try {\n      await this.updateStateCache();\n      return this.state.lastKnownState?.rightAntenna\n        ? radToDeg(this.state.lastKnownState.rightAntenna)\n        : 0;\n    } catch (error) {\n      console.error('Failed to get right antenna angle:', error);\n      return 0;\n    }\n  }\n\n  /**\n   * Get current body yaw (degrees)\n   */\n  async getBodyYaw(): Promise<number> {\n    try {\n      await this.updateStateCache();\n      return this.state.lastKnownState?.bodyYaw ? radToDeg(this.state.lastKnownState.bodyYaw) : 0;\n    } catch (error) {\n      console.error('Failed to get body yaw:', error);\n      return 0;\n    }\n  }\n\n  /**\n   * Get current motor mode\n   */\n  async getMotorMode(): Promise<string> {\n    try {\n      await this.updateStateCache();\n      return this.state.lastKnownState?.motorMode ?? 'unknown';\n    } catch (error) {\n      console.error('Failed to get motor mode:', error);\n      return 'unknown';\n    }\n  }\n\n  // ==========================================================================\n  // Block Implementations - System\n  // ==========================================================================\n\n  /**\n   * Check if daemon is connected\n   */\n  async isDaemonConnected(): Promise<boolean> {\n    try {\n      const connected = await apiClient.ping();\n      this.state.connectionStatus = connected ? 'connected' : 'disconnected';\n      return connected;\n    } catch (_error) {\n      this.state.connectionStatus = 'error';\n      return false;\n    }\n  }\n\n  // ==========================================================================\n  // Helper Methods\n  // ==========================================================================\n\n  /**\n   * Waits until the most recent goto-style move finishes running.\n   * Provides a small buffer past the commanded duration and polls the daemon.\n   */\n  private async waitForMotionCompletion(duration: number): Promise<void> {\n    const baseWait = duration * 1000 + 150;\n    await sleep(baseWait);\n\n    const maxPollTime = 2000;\n    const pollInterval = 120;\n    const start = Date.now();\n\n    while (Date.now() - start < maxPollTime) {\n      try {\n        const isRunning = await apiClient.isMovementRunning();\n        if (!isRunning) {\n          await sleep(100);\n          return;\n        }\n      } catch (error) {\n        console.warn('Failed to verify movement completion:', error);\n        return;\n      }\n      await sleep(pollInterval);\n    }\n\n    console.warn('Movement still running after waitForMotionCompletion timeout');\n  }\n\n  /**\n   * Updates the cached robot state\n   */\n  private async updateStateCache(): Promise<void> {\n    try {\n      const fullState = await apiClient.getFullState();\n      const motorStatus = await apiClient.getMotorStatus();\n\n      // Extract head pose\n      const headPose = fullState.head_pose;\n      let pitch = 0,\n        yaw = 0,\n        roll = 0;\n\n      if (headPose && 'pitch' in headPose) {\n        pitch = headPose.pitch ?? 0;\n        yaw = headPose.yaw ?? 0;\n        roll = headPose.roll ?? 0;\n      }\n\n      // Extract antenna positions\n      const antennas = fullState.antennas_position ?? [0, 0];\n      const leftAntenna = antennas[0] ?? 0;\n      const rightAntenna = antennas[1] ?? 0;\n\n      // Extract body yaw\n      const bodyYaw = fullState.body_yaw ?? 0;\n\n      // Update cache\n      this.state.lastKnownState = {\n        headPitch: pitch,\n        headYaw: yaw,\n        headRoll: roll,\n        leftAntenna,\n        rightAntenna,\n        bodyYaw,\n        motorMode: motorStatus.mode,\n      };\n\n      this.state.lastStateUpdate = Date.now();\n      this.state.connectionStatus = 'connected';\n    } catch (error) {\n      console.error('Failed to update state cache:', error);\n      this.state.connectionStatus = 'error';\n      throw error;\n    }\n  }\n}\n\n// ============================================================================\n// Scratch Extension API Types\n// ============================================================================\n\n/**\n * Block type literal\n */\ntype BlockType = 'command' | 'reporter' | 'Boolean';\n\n/**\n * Argument type literal\n */\ntype ArgumentType = 'number' | 'string' | 'Boolean';\n\n/**\n * Extension info interface\n */\ninterface ExtensionInfo {\n  id: string;\n  name: string;\n  color1?: string;\n  color2?: string;\n  color3?: string;\n  blocks: (BlockDefinition | string)[];\n  menus?: Record<string, MenuDefinition>;\n}\n\n/**\n * Block definition interface\n */\ninterface BlockDefinition {\n  opcode: string;\n  blockType: BlockType;\n  text: string;\n  arguments?: Record<string, ArgumentDefinition>;\n}\n\n/**\n * Argument definition interface\n */\ninterface ArgumentDefinition {\n  type: ArgumentType;\n  menu?: string;\n  defaultValue?: string | number | boolean;\n}\n\n/**\n * Menu definition interface\n */\ninterface MenuDefinition {\n  acceptReporters?: boolean;\n  items: MenuItem[] | string;\n}\n\n/**\n * Menu item interface\n */\ninterface MenuItem {\n  text: string;\n  value: string | number;\n}\n","/**\n * Reachy Mini TurboWarp Extension\n * Entry point for extension registration\n */\n\nimport { ReachyMiniExtension } from './extension.js';\n\n/**\n * Declare global Scratch object\n */\ndeclare const Scratch: {\n  extensions: {\n    register: (extension: unknown) => void;\n  };\n};\n\n/**\n * Register the extension with Scratch/TurboWarp\n */\n(function (Scratch) {\n  'use strict';\n\n  if (!Scratch || !Scratch.extensions) {\n    throw new Error('This extension must be run in a Scratch 3.0 environment');\n  }\n\n  // Register the extension\n  Scratch.extensions.register(new ReachyMiniExtension());\n})(Scratch);\n"],"names":["LOCALHOST_HOSTNAMES","sanitizeBaseUrl","rawUrl","parsed","normalizedPath","error","encodeDatasetPath","rawDatasetName","trimmed","segment","DEFAULT_API_CONFIG","ApiError","message","statusCode","originalError","makeRequest","url","options","timeout","controller","timeoutId","response","ReachyMiniApiClient","config","baseUrl","nextBaseUrl","request","payload","datasetName","datasetSegment","moveName","moveSegment","mode","apiClient","degToRad","degrees","radToDeg","radians","sleep","ms","resolve","EN_MESSAGES","TRANSLATIONS","getScratch","setupTranslations","scratch","translateFn","currentLanguage","runtimeLocale","resolveLocale","translatorLocale","formatMessage","id","locale","HEAD_DIRECTION_PRESETS","BASE_HEAD_POSE","PRESET_MOTIONS","buildHeadPose","overrides","DEFAULT_RECORDED_DATASET","EMOTIONS_RECORDED_DATASET","DANCE_RECORDED_MOVES","EMOTIONS_RECORDED_MOVES","RECORDED_DATASET_LABELS","RECORDED_MOVE_VALUE_SEPARATOR","RECORDED_MOVE_WORD_LABELS","encodeRecordedMoveSelection","dataset","move","decodeRecordedMoveSelection","value","buildRecordedMoveMenuItems","splitRecordedMoveWords","lower","match","rawWord","number","baseWord","entries","capitalizeWord","word","formatRecordedMoveLabel","words","ReachyMiniExtension","recordedMoveMenuItems","labelId","datasetLabel","moveLabel","defaultRecordedMoveValue","result","maxWaitTime","pollInterval","startTime","args","direction","duration","preset","pitch","yaw","roll","presetId","cyclesInput","cycles","cycle","step","left","right","angle","bodyYaw","connected","baseWait","maxPollTime","start","fullState","motorStatus","headPose","antennas","leftAntenna","rightAntenna","Scratch"],"mappings":"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AS,CAAC,EAAG,SAAU,GAAA,EAC9D,CAAE,KAAM,CAAE,IAAKA,EAAS,EAAE,CAAA,EAAK,QAASA,EAAS,EAAE,EAAG,SAAU,GAAA,EAChE,CAAE,KAAM,CAAE,IAAK,GAAK,QAAS,EAAG,SAAU,EAAA,CAAI,CAChD,CAEJ,EAKMuB,EAAiBC,IAAiD,CACtE,EAAGA,GAAW,GAAKH,EAAe,EAClC,EAAGG,GAAW,GAAKH,EAAe,EAClC,EAAGG,GAAW,GAAKH,EAAe,EAClC,KAAMG,GAAW,MAAQH,EAAe,KACxC,MAAOG,GAAW,OAASH,EAAe,MAC1C,IAAKG,GAAW,KAAOH,EAAe,GACxC,GAKMI,EAA2B,6CAC3BC,EAA4B,+CAC5BC,EAAuB,CAC3B,uBACA,mBACA,cACA,oBACA,aACA,cACA,iBACA,gBACA,kBACA,YACA,sBACA,iBACA,WACA,qBACA,eACA,aACA,mBACA,YACA,oBACA,gBACF,EACMC,EAA0B,CAC9B,SACA,cACA,aACA,aACA,aACA,SACA,aACA,WACA,YACA,OACA,cACA,gBACA,iBACA,UACA,aACA,WACA,YACA,UACA,aACA,WACA,eACA,cACA,cACA,aACA,QACA,MACA,YACA,OACA,YACA,WACA,YACA,aACA,QACA,cACA,aACA,aACA,SACA,SACA,YACA,aACA,SACA,UACA,gBACA,aACA,WACA,aACA,aACA,aACA,QACA,WACA,aACA,iBACA,SACA,WACA,YACA,WACA,SACA,QACA,WACA,UACA,WACA,aACA,oBACA,YACA,aACA,QACA,QACA,WACA,iBACA,YACA,cACA,WACA,UACA,OACA,SACA,OACA,UACA,aACA,SACA,YACA,SACF,EACMC,EAAqD,CACzD,CAACJ,CAAwB,EAAG,0CAC5B,CAACC,CAAyB,EAAG,2CAC/B,EACMI,EAAgC,KAEhCC,EAAwE,CAC5E,EAAK,CAAE,GAAI,IAAK,GAAI,GAAA,EACpB,EAAK,CAAE,GAAI,IAAK,GAAI,GAAA,EACpB,EAAK,CAAE,GAAI,IAAK,GAAI,GAAA,EACpB,OAAQ,CAAE,GAAI,SAAU,GAAI,IAAA,EAC5B,IAAK,CAAE,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"}